<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Umid">
        <link rel="canonical" href="https://deepcode-academy.vercel.app/drf/background-tasks-and-celery/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Background Tasks and Celery - DeepCode Academy</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">DeepCode Academy</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/what-is-python/" class="dropdown-item">What is Python</a>
</li>
                                    
<li>
    <a href="../../python/variables/" class="dropdown-item">Variables</a>
</li>
                                    
<li>
    <a href="../../python/data-types/" class="dropdown-item">Data Types</a>
</li>
                                    
<li>
    <a href="../../python/operators/" class="dropdown-item">Operatos</a>
</li>
                                    
<li>
    <a href="../../python/lists/" class="dropdown-item">Lists</a>
</li>
                                    
<li>
    <a href="../../python/tuples/" class="dropdown-item">Tuples</a>
</li>
                                    
<li>
    <a href="../../python/sets/" class="dropdown-item">Sets</a>
</li>
                                    
<li>
    <a href="../../python/dictionaries/" class="dropdown-item">Dictionaries</a>
</li>
                                    
<li>
    <a href="../../python/conditional-statements/" class="dropdown-item">Conditional Statements</a>
</li>
                                    
<li>
    <a href="../../python/for-loop/" class="dropdown-item">For Loop</a>
</li>
                                    
<li>
    <a href="../../python/while-loop/" class="dropdown-item">While Loop</a>
</li>
                                    
<li>
    <a href="../../python/functions/" class="dropdown-item">Functions</a>
</li>
                                    
<li>
    <a href="../../python/exception-handling/" class="dropdown-item">Exception Handling</a>
</li>
                                    
<li>
    <a href="../../python/moduls/" class="dropdown-item">Moduls</a>
</li>
                                    
<li>
    <a href="../../python/file-handling/" class="dropdown-item">File Handling</a>
</li>
                                    
<li>
    <a href="../../python/database/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../../python/third-party-packages/" class="dropdown-item">Third Party Packages</a>
</li>
                                    
<li>
    <a href="../../python/oop/" class="dropdown-item">OOP</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">PostgreSQL</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../psql/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../psql/postgresql/" class="dropdown-item">PostgreSQL</a>
</li>
                                    
<li>
    <a href="../../psql/basic-commands/" class="dropdown-item">Basic Commands</a>
</li>
                                    
<li>
    <a href="../../psql/data-retrieval-end-filtering/" class="dropdown-item">Data Retrieval and Filtering</a>
</li>
                                    
<li>
    <a href="../../psql/function-and-aggregation/" class="dropdown-item">Function and Aggregation</a>
</li>
                                    
<li>
    <a href="../../psql/data-manipulation/" class="dropdown-item">Data Manipulation</a>
</li>
                                    
<li>
    <a href="../../psql/joins-and-advanced-queries/" class="dropdown-item">Joins and Advanced Queries</a>
</li>
                                    
<li>
    <a href="../../psql/psql-connect-in-python/" class="dropdown-item">PostgreSQL connect in Python</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../django/introduction-to-django/" class="dropdown-item">Introduction to Django</a>
</li>
                                    
<li>
    <a href="../../django/django-project-structure/" class="dropdown-item">Django Project Structure</a>
</li>
                                    
<li>
    <a href="../../django/url-dispatcher-and-views/" class="dropdown-item">Url Dispatcher and Views</a>
</li>
                                    
<li>
    <a href="../../django/templates/" class="dropdown-item">Templates (Working with HTML)</a>
</li>
                                    
<li>
    <a href="../../django/static-files-and-bootstrap/" class="dropdown-item">Static Files and Bootstrap</a>
</li>
                                    
<li>
    <a href="../../django/django-orm-and-models/" class="dropdown-item">Django ORM and Models</a>
</li>
                                    
<li>
    <a href="../../django/django-admin-panel/" class="dropdown-item">Django Admin Panel</a>
</li>
                                    
<li>
    <a href="../../django/django-forms/" class="dropdown-item">Django Forms</a>
</li>
                                    
<li>
    <a href="../../django/crud-operations/" class="dropdown-item">CRUD Operations</a>
</li>
                                    
<li>
    <a href="../../django/queryset-and-filtering/" class="dropdown-item">QuerySet and Filtering</a>
</li>
                                    
<li>
    <a href="../../django/django-authentication-system/" class="dropdown-item">Django Authentication System</a>
</li>
                                    
<li>
    <a href="../../django/middleware-and-sessions/" class="dropdown-item">Middleware and Sessions</a>
</li>
                                    
<li>
    <a href="../../django/class-based-views/" class="dropdown-item">Class-Based Views (CBV)</a>
</li>
                                    
<li>
    <a href="../../django/django-messages-framework/" class="dropdown-item">Django Messages Framework</a>
</li>
                                    
<li>
    <a href="../../django/file-upload-and-media-files/" class="dropdown-item">File Upload and Media Files</a>
</li>
                                    
<li>
    <a href="../../django/project-planning/" class="dropdown-item">Project Planning</a>
</li>
                                    
<li>
    <a href="../../django/build-models-and-database/" class="dropdown-item">Build Models and Database</a>
</li>
                                    
<li>
    <a href="../../django/designing-and-frontend/" class="dropdown-item">Designing and Frontend</a>
</li>
                                    
<li>
    <a href="../../django/authentication-and-user-pages/" class="dropdown-item">Authentication and User Pages</a>
</li>
                                    
<li>
    <a href="../../django/deploy-and-finalizations/" class="dropdown-item">Deploy and Finalizations</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django REST Framework</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Introduction to DRF</a>
</li>
                                    
<li>
    <a href="../setting-up-django-project-and-drf/" class="dropdown-item">Setting Up a Django Project and DRF</a>
</li>
                                    
<li>
    <a href="../creating-the-first-api/" class="dropdown-item">Creating the First API</a>
</li>
                                    
<li>
    <a href="../implementing-crud-operations/" class="dropdown-item">Implementing CRUD Operations</a>
</li>
                                    
<li>
    <a href="../working-with-modelserializer/" class="dropdown-item">Working with ModelSerializer</a>
</li>
                                    
<li>
    <a href="../using-generic-api-views/" class="dropdown-item">Using Generic API Views</a>
</li>
                                    
<li>
    <a href="../viewsets-and-routers/" class="dropdown-item">ViewSets and Routers</a>
</li>
                                    
<li>
    <a href="../authentication-token-based/" class="dropdown-item">Authentication (Token-Based Authentication)</a>
</li>
                                    
<li>
    <a href="../working-with-permissions/" class="dropdown-item">Working with Permissions</a>
</li>
                                    
<li>
    <a href="../throttling-and-rate-limiting/" class="dropdown-item">Throttling and Rate Limiting</a>
</li>
                                    
<li>
    <a href="../filtering-searching-and-ordering/" class="dropdown-item">Filtering, Searching, and Ordering</a>
</li>
                                    
<li>
    <a href="../working-with-pagination/" class="dropdown-item">Working with Pagination</a>
</li>
                                    
<li>
    <a href="../jwt-authentication/" class="dropdown-item">JWT Authentication</a>
</li>
                                    
<li>
    <a href="../signals-and-drf/" class="dropdown-item">Signals and DRF</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Background Tasks and Celery</a>
</li>
                                    
<li>
    <a href="../api-testing-and-unit-testing/" class="dropdown-item">API Testing and Unit Testing</a>
</li>
                                    
<li>
    <a href="../caching-and-performance-optimization/" class="dropdown-item">Caching and Performance Optimization</a>
</li>
                                    
<li>
    <a href="../websockets-and-django-channels/" class="dropdown-item">WebSockets and Django Channels</a>
</li>
                                    
<li>
    <a href="../deployment-and-docker/" class="dropdown-item">Deployment and Docker</a>
</li>
                                    
<li>
    <a href="../advanced-concepts-and-best-practices/" class="dropdown-item">Advanced Concepts and Best Practices</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../signals-and-drf/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../api-testing-and-unit-testing/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#14-dars-fon-vazifalari-va-celery-bilan-ishlash" class="nav-link">🧩 14-DARS: FON VAZIFALARI VA CELERY BILAN ISHLASH</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-tayyorlov-ishlari" class="nav-link">✅ 1. TAYYORLOV ISHLARI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-celery-va-fon-vazifalarini-tushunish" class="nav-link">✅ 2. CELERY VA FON VAZIFALARINI TUSHUNISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-celery-va-redis-ni-ornatish" class="nav-link">✅ 3. CELERY VA REDIS NI O'RNATISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-celery-sozlamalarini-qoshish" class="nav-link">✅ 4. CELERY SOZLAMALARINI QO'SHISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-loyiha-sozlamalarini-yangilash" class="nav-link">✅ 5. LOYIHA SOZLAMALARINI YANGILASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-fon-vazifasini-yaratish" class="nav-link">✅ 6. FON VAZIFASINI YARATISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#7-signallarni-celery-bilan-integratsiya-qilish" class="nav-link">✅ 7. SIGNALLARNI CELERY BILAN INTEGRATSIYA QILISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8-celery-ishga-tushirish" class="nav-link">✅ 8. CELERY ISHGA TUSHIRISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#9-viewset-ni-tekshirish" class="nav-link">✅ 9. VIEWSET NI TEKSHIRISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#10-url-sozlash" class="nav-link">✅ 10. URL SOZLASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#11-celery-vazifalarini-sinab-korish" class="nav-link">✅ 11. CELERY VAZIFALARINI SINAB KO'RISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#12-admin-paneli-orqali-sinov-ixtiyoriy" class="nav-link">✅ 12. ADMIN PANELI ORQALI SINOV (IXTIYORIY)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#13-sinov-uchun-masalalar" class="nav-link">✅ 13. SINOV UCHUN MASALALAR</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="14-dars-fon-vazifalari-va-celery-bilan-ishlash">🧩 14-DARS: FON VAZIFALARI VA CELERY BILAN ISHLASH</h1>
<p>Bu darsda Django REST Framework (DRF) yordamida fon vazifalarini (background tasks) va Celery bilan ishlashni bosqichma-bosqich o'rganamiz. Celery uzoq davom etadigan yoki resurs talab qiladigan vazifalarni asinxron tarzda bajarish uchun ishlatiladi. Har bir qadam tushunarli va faqat fon vazifalari va Celery ga qaratilgan bo'ladi. Oldingi darslarda sozlangan <code>myproject</code> loyihasi va <code>myapp</code> ilovasidagi <code>Task</code> modeli, JWT autentifikatsiyasi, ruxsatlar va signallar asosida davom etamiz.</p>
<h2 id="1-tayyorlov-ishlari">✅ 1. TAYYORLOV ISHLARI</h2>
<p>📌 Loyiha va ilova allaqachon sozlangan deb hisoblaymiz (<code>myproject</code>, <code>myapp</code>, va <code>Task</code> modeli). Quyidagi sozlamalar mavjud bo'lishi kerak:
- <code>Task</code> modeli <code>myapp/models.py</code> faylida belgilangan (shu jumladan <code>owner</code> maydoni).
- <code>TaskSerializer</code> <code>myapp/serializers.py</code> faylida yaratilgan.
- <code>TaskViewSet</code> <code>myapp/views.py</code> faylida sozlangan (JWT autentifikatsiyasi, ruxsatlar, filtrlash va sahifalash bilan).
- Signallar <code>myapp/signals.py</code> faylida sozlangan.
- <code>/tasks/</code> endpointi <code>myproject/urls.py</code> faylida sozlangan.
📌 Agar bu sozlamalar hali amalga oshirilmagan bo'lsa, avvalgi darslarga qayting.</p>
<h2 id="2-celery-va-fon-vazifalarini-tushunish">✅ 2. CELERY VA FON VAZIFALARINI TUSHUNISH</h2>
<p>📌 <strong>Celery</strong> — Python loyihalarida asinxron vazifalarni boshqarish uchun kuchli vosita. U uzoq vaqt talab qiladigan vazifalarni (masalan, log yozish, email yuborish) asosiy ilova jarayonidan ajratib, fon rejimida bajaradi.
📌 <strong>Fon vazifalari</strong>:
- API so'rovlarining tezligini oshiradi.
- Serverni ortiqcha yukdan himoya qiladi.
- Vazifalarni parallel ravishda bajarish imkonini beradi.
📌 Celery ishlatish uchun <strong>Redis</strong> yoki <strong>RabbitMQ</strong> kabi xabar brokeri talab qilinadi. Ushbu darsda Redis dan foydalanamiz.</p>
<h2 id="3-celery-va-redis-ni-ornatish">✅ 3. CELERY VA REDIS NI O'RNATISH</h2>
<p>📌 Quyidagi paketlarni o'rnatamiz:</p>
<pre><code class="language-bash">pip install celery redis
</code></pre>
<p>📌 Redis ni o'rnatish (masalan, Ubuntu uchun):</p>
<pre><code class="language-bash">sudo apt-get install redis-server
</code></pre>
<p>📌 Redis serverini ishga tushiring va uning ishlayotganligini tekshiring:</p>
<pre><code class="language-bash">redis-server
redis-cli ping  # Javob: PONG
</code></pre>
<h2 id="4-celery-sozlamalarini-qoshish">✅ 4. CELERY SOZLAMALARINI QO'SHISH</h2>
<p>📌 <code>myproject</code> papkasida <code>celery.py</code> faylini yarating va quyidagi kodni qo'shing:</p>
<pre><code class="language-python">import os
from celery import Celery

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproject.settings')

app = Celery('myproject')

app.config_from_object('django.conf:settings', namespace='CELERY')

app.autodiscover_tasks()
</code></pre>
<p>📌 <strong>Tushuntirish</strong>:
- <code>Celery('myproject')</code>: Celery ilovasini yaratadi.
- <code>config_from_object</code>: Django sozlamalaridan Celery konfiguratsiyasini oladi.
- <code>autodiscover_tasks</code>: Ilovadagi vazifalarni avtomatik topadi.</p>
<p>📌 <code>myproject/__init__.py</code> faylini yangilang:</p>
<pre><code class="language-python">from .celery import app as celery_app

__all__ = ('celery_app',)
</code></pre>
<h2 id="5-loyiha-sozlamalarini-yangilash">✅ 5. LOYIHA SOZLAMALARINI YANGILASH</h2>
<p>📌 <code>myproject/settings.py</code> faylida Celery va Redis sozlamalarini qo'shamiz:</p>
<pre><code class="language-python">INSTALLED_APPS = [
    ...
    'rest_framework',
    'rest_framework.authtoken',
    'django_filters',
    'myapp.apps.MyappConfig',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_THROTTLE_CLASSES': [
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle',
    ],
    'DEFAULT_THROTTLE_RATES': {
        'anon': '10/hour',
        'user': '20/hour',
    },
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 5,
}

# Celery sozlamalari
CELERY_BROKER_URL = 'redis://localhost:6379/0'  # Redis broker manzili
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'  # Natijalarni saqlash uchun
CELERY_ACCEPT_CONTENT = ['json']
CELERY_TASK_SERIALIZER = 'json'
CELERY_RESULT_SERIALIZER = 'json'
CELERY_TIMEZONE = 'Asia/Tashkent'  # O'zbekiston vaqt zonasi
</code></pre>
<p>📌 <strong>Tushuntirish</strong>:
- <code>CELERY_BROKER_URL</code>: Redis server manzili (standart port 6379).
- <code>CELERY_TIMEZONE</code>: Vaqt zonasi sifatida <code>Asia/Tashkent</code> ishlatiladi.</p>
<h2 id="6-fon-vazifasini-yaratish">✅ 6. FON VAZIFASINI YARATISH</h2>
<p>📌 <code>myapp/tasks.py</code> faylini yarating va vazifa yaratilganda log yozish uchun fon vazifasini qo'shing:</p>
<pre><code class="language-python">from celery import shared_task
import logging

logger = logging.getLogger(__name__)

@shared_task
def log_task_creation(task_id, task_title, owner_username):
    logger.info(f&quot;[Celery] Yangi vazifa yaratildi: {task_title} (ID: {task_id}, Owner: {owner_username})&quot;)
</code></pre>
<p>📌 <strong>Tushuntirish</strong>:
- <code>@shared_task</code>: Celery vazifasini belgilaydi.
- <code>log_task_creation</code>: Vazifa yaratilganda log yozadi.</p>
<h2 id="7-signallarni-celery-bilan-integratsiya-qilish">✅ 7. SIGNALLARNI CELERY BILAN INTEGRATSIYA QILISH</h2>
<p>📌 <code>myapp/signals.py</code> faylini yangilaymiz va vazifa yaratilganda Celery vazifasini chaqiramiz:</p>
<pre><code class="language-python">from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from .models import Task
from .tasks import log_task_creation
import logging

logger = logging.getLogger(__name__)

@receiver(post_save, sender=Task)
def handle_task_creation(sender, instance, created, **kwargs):
    if created:
        # Celery vazifasini fon rejimida ishga tushirish
        log_task_creation.delay(instance.id, instance.title, instance.owner.username)
    else:
        logger.info(f&quot;Vazifa yangilandi: {instance.title} (ID: {instance.id}, Owner: {instance.owner.username})&quot;)

@receiver(post_delete, sender=Task)
def log_task_deletion(sender, instance, **kwargs):
    logger.info(f&quot;Vazifa o'chirildi: {instance.title} (ID: {instance.id}, Owner: {instance.owner.username})&quot;)
</code></pre>
<p>📌 <strong>Tushuntirish</strong>:
- <code>log_task_creation.delay</code>: Celery vazifasini asinxron tarzda ishga tushiradi.
- <code>post_delete</code> signali o'zgarmagan holda qoldi.</p>
<h2 id="8-celery-ishga-tushirish">✅ 8. CELERY ISHGA TUSHIRISH</h2>
<p>📌 Celery worker ni ishga tushirish uchun yangi terminal oching va loyiha papkasida quyidagi buyruqni bajaring:</p>
<pre><code class="language-bash">celery -A myproject worker --loglevel=info
</code></pre>
<p>📌 <strong>Eslatma</strong>: Redis serveri ishlayotgan bo'lishi kerak.</p>
<h2 id="9-viewset-ni-tekshirish">✅ 9. VIEWSET NI TEKSHIRISH</h2>
<p>📌 <code>myapp/views.py</code> faylida <code>TaskViewSet</code> oldingi darsdagidek qoladi:</p>
<pre><code class="language-python">from rest_framework import viewsets
from django_filters.rest_framework import DjangoFilterBackend
from rest_framework.filters import SearchFilter, OrderingFilter
from .models import Task
from .serializers import TaskSerializer
from .permissions import IsOwnerOrReadOnly
from .pagination import CustomTaskPagination
from rest_framework.permissions import IsAuthenticated

class TaskViewSet(viewsets.ModelViewSet):
    queryset = Task.objects.all()
    serializer_class = TaskSerializer
    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]
    filter_backends = [DjangoFilterBackend, SearchFilter, OrderingFilter]
    filterset_fields = ['completed', 'owner']
    search_fields = ['title', 'description']
    ordering_fields = ['created_at', 'completed']
    ordering = ['created_at']
    pagination_class = CustomTaskPagination

    def perform_create(self, serializer):
        serializer.save(owner=self.request.user)
</code></pre>
<h2 id="10-url-sozlash">✅ 10. URL SOZLASH</h2>
<p>📌 <code>myproject/urls.py</code> faylida URL marshrutlari oldingi darsdagidek qoladi:</p>
<pre><code class="language-python">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView
from myapp.views import TaskViewSet

router = DefaultRouter()
router.register(r'tasks', TaskViewSet)

urlpatterns = [
    path('', include(router.urls)),
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
]
</code></pre>
<h2 id="11-celery-vazifalarini-sinab-korish">✅ 11. CELERY VAZIFALARINI SINAB KO'RISH</h2>
<p>📌 Serverni ishga tushiring:</p>
<pre><code class="language-bash">python manage.py runserver
</code></pre>
<p>📌 Celery worker ni alohida terminalda ishga tushiring:</p>
<pre><code class="language-bash">celery -A myproject worker --loglevel=info
</code></pre>
<h3 id="foydalanuvchi-va-token-yaratish">❇️ <strong>Foydalanuvchi va token yaratish</strong>:</h3>
<p>📌 Agar hali yaratilmagan bo'lsa, foydalanuvchi yarating:</p>
<pre><code class="language-bash">python manage.py createsuperuser  # username: user1, password: pass123
</code></pre>
<p>📌 JWT token oling:</p>
<pre><code class="language-bash">curl -X POST http://127.0.0.1:8000/api/token/ -H &quot;Content-Type: application/json&quot; -d '{&quot;username&quot;: &quot;user1&quot;, &quot;password&quot;: &quot;pass123&quot;}'
</code></pre>
<h3 id="vazifa-yaratish-va-celery-sinovi">❇️ <strong>Vazifa yaratish va Celery sinovi</strong>:</h3>
<p>📌 <strong>Manzil</strong>: <code>http://127.0.0.1:8000/tasks/</code><br />
📌 <strong>Usul</strong>: POST  </p>
<pre><code class="language-bash">curl -X POST http://127.0.0.1:8000/tasks/ -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;Content-Type: application/json&quot; -d '{&quot;title&quot;: &quot;Yangi vazifa&quot;, &quot;description&quot;: &quot;Test vazifa&quot;}'
</code></pre>
<p>📌 Celery worker terminalida yoki <code>debug.log</code> faylida quyidagi logni ko'rasiz:</p>
<pre><code>[Celery] Yangi vazifa yaratildi: Yangi vazifa (ID: 1, Owner: user1)
</code></pre>
<h3 id="vazifa-yangilash-va-signal-sinovi">❇️ <strong>Vazifa yangilash va signal sinovi</strong>:</h3>
<p>📌 <strong>Manzil</strong>: <code>http://127.0.0.1:8000/tasks/1/</code><br />
📌 <strong>Usul</strong>: PATCH  </p>
<pre><code class="language-bash">curl -X PATCH http://127.0.0.1:8000/tasks/1/ -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;Content-Type: application/json&quot; -d '{&quot;completed&quot;: true}'
</code></pre>
<p>📌 Log (Celery emas, signal orqali):</p>
<pre><code>Vazifa yangilandi: Yangi vazifa (ID: 1, Owner: user1)
</code></pre>
<h3 id="vazifa-ochirish-va-signal-sinovi">❇️ <strong>Vazifa o'chirish va signal sinovi</strong>:</h3>
<p>📌 <strong>Manzil</strong>: <code>http://127.0.0.1:8000/tasks/1/</code><br />
📌 <strong>Usul</strong>: DELETE  </p>
<pre><code class="language-bash">curl -X DELETE http://127.0.0.1:8000/tasks/1/ -H &quot;Authorization: Bearer &lt;access_token&gt;&quot;
</code></pre>
<p>📌 Log:</p>
<pre><code>Vazifa o'chirildi: Yangi vazifa (ID: 1, Owner: user1)
</code></pre>
<h2 id="12-admin-paneli-orqali-sinov-ixtiyoriy">✅ 12. ADMIN PANELI ORQALI SINOV (IXTIYORIY)</h2>
<p>📌 Ma'lumotlarni qo'lda sinash uchun admin panelidan foydalaning:</p>
<h3 id="admin-foydalanuvchisini-tekshirish">❇️ <strong>Admin foydalanuvchisini tekshirish</strong>:</h3>
<pre><code class="language-bash">python manage.py createsuperuser
</code></pre>
<h3 id="modelni-admin-panelida-royxatdan-otkazish">❇️ <strong>Modelni admin panelida ro'yxatdan o'tkazish</strong>:</h3>
<p>📌 <code>myapp/admin.py</code> faylida:</p>
<pre><code class="language-python">from django.contrib import admin
from .models import Task

admin.site.register(Task)
</code></pre>
<p>📌 <code>http://127.0.0.1:8000/admin/</code> manzilida vazifalarni qo'shing yoki tahrirlang va loglarni tekshiring.</p>
<h2 id="13-sinov-uchun-masalalar">✅ 13. SINOV UCHUN MASALALAR</h2>
<p>📌 Celery vazifalarini sinash uchun quyidagi amallarni bajarib ko'ring:
1. <code>/tasks/</code> manzilida yangi vazifa qo'shing va <code>debug.log</code> yoki Celery terminalida logni tekshiring.
2. Admin panelida vazifa qo'shing va Celery logini ko'ring.
3. Celery workerni o'chirib, vazifa qo'shing va logning kechiktirilganligini tekshiring.
4. <code>/tasks/1/</code> manzilida vazifani yangilang va signal logini tekshiring.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
