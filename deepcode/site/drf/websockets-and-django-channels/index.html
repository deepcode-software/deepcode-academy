<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Umid">
        <link rel="canonical" href="https://deepcode-academy.vercel.app/drf/websockets-and-django-channels/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>WebSockets and Django Channels - DeepCode Academy</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">DeepCode Academy</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/what-is-python/" class="dropdown-item">What is Python</a>
</li>
                                    
<li>
    <a href="../../python/variables/" class="dropdown-item">Variables</a>
</li>
                                    
<li>
    <a href="../../python/data-types/" class="dropdown-item">Data Types</a>
</li>
                                    
<li>
    <a href="../../python/operators/" class="dropdown-item">Operatos</a>
</li>
                                    
<li>
    <a href="../../python/lists/" class="dropdown-item">Lists</a>
</li>
                                    
<li>
    <a href="../../python/tuples/" class="dropdown-item">Tuples</a>
</li>
                                    
<li>
    <a href="../../python/sets/" class="dropdown-item">Sets</a>
</li>
                                    
<li>
    <a href="../../python/dictionaries/" class="dropdown-item">Dictionaries</a>
</li>
                                    
<li>
    <a href="../../python/conditional-statements/" class="dropdown-item">Conditional Statements</a>
</li>
                                    
<li>
    <a href="../../python/for-loop/" class="dropdown-item">For Loop</a>
</li>
                                    
<li>
    <a href="../../python/while-loop/" class="dropdown-item">While Loop</a>
</li>
                                    
<li>
    <a href="../../python/functions/" class="dropdown-item">Functions</a>
</li>
                                    
<li>
    <a href="../../python/exception-handling/" class="dropdown-item">Exception Handling</a>
</li>
                                    
<li>
    <a href="../../python/moduls/" class="dropdown-item">Moduls</a>
</li>
                                    
<li>
    <a href="../../python/file-handling/" class="dropdown-item">File Handling</a>
</li>
                                    
<li>
    <a href="../../python/database/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../../python/third-party-packages/" class="dropdown-item">Third Party Packages</a>
</li>
                                    
<li>
    <a href="../../python/oop/" class="dropdown-item">OOP</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">PostgreSQL</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../psql/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../psql/postgresql/" class="dropdown-item">PostgreSQL</a>
</li>
                                    
<li>
    <a href="../../psql/basic-commands/" class="dropdown-item">Basic Commands</a>
</li>
                                    
<li>
    <a href="../../psql/data-retrieval-end-filtering/" class="dropdown-item">Data Retrieval and Filtering</a>
</li>
                                    
<li>
    <a href="../../psql/function-and-aggregation/" class="dropdown-item">Function and Aggregation</a>
</li>
                                    
<li>
    <a href="../../psql/data-manipulation/" class="dropdown-item">Data Manipulation</a>
</li>
                                    
<li>
    <a href="../../psql/joins-and-advanced-queries/" class="dropdown-item">Joins and Advanced Queries</a>
</li>
                                    
<li>
    <a href="../../psql/psql-connect-in-python/" class="dropdown-item">PostgreSQL connect in Python</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../django/introduction-to-django/" class="dropdown-item">Introduction to Django</a>
</li>
                                    
<li>
    <a href="../../django/django-project-structure/" class="dropdown-item">Django Project Structure</a>
</li>
                                    
<li>
    <a href="../../django/url-dispatcher-and-views/" class="dropdown-item">Url Dispatcher and Views</a>
</li>
                                    
<li>
    <a href="../../django/templates/" class="dropdown-item">Templates (Working with HTML)</a>
</li>
                                    
<li>
    <a href="../../django/static-files-and-bootstrap/" class="dropdown-item">Static Files and Bootstrap</a>
</li>
                                    
<li>
    <a href="../../django/django-orm-and-models/" class="dropdown-item">Django ORM and Models</a>
</li>
                                    
<li>
    <a href="../../django/django-admin-panel/" class="dropdown-item">Django Admin Panel</a>
</li>
                                    
<li>
    <a href="../../django/django-forms/" class="dropdown-item">Django Forms</a>
</li>
                                    
<li>
    <a href="../../django/crud-operations/" class="dropdown-item">CRUD Operations</a>
</li>
                                    
<li>
    <a href="../../django/queryset-and-filtering/" class="dropdown-item">QuerySet and Filtering</a>
</li>
                                    
<li>
    <a href="../../django/django-authentication-system/" class="dropdown-item">Django Authentication System</a>
</li>
                                    
<li>
    <a href="../../django/middleware-and-sessions/" class="dropdown-item">Middleware and Sessions</a>
</li>
                                    
<li>
    <a href="../../django/class-based-views/" class="dropdown-item">Class-Based Views (CBV)</a>
</li>
                                    
<li>
    <a href="../../django/django-messages-framework/" class="dropdown-item">Django Messages Framework</a>
</li>
                                    
<li>
    <a href="../../django/file-upload-and-media-files/" class="dropdown-item">File Upload and Media Files</a>
</li>
                                    
<li>
    <a href="../../django/project-planning/" class="dropdown-item">Project Planning</a>
</li>
                                    
<li>
    <a href="../../django/build-models-and-database/" class="dropdown-item">Build Models and Database</a>
</li>
                                    
<li>
    <a href="../../django/designing-and-frontend/" class="dropdown-item">Designing and Frontend</a>
</li>
                                    
<li>
    <a href="../../django/authentication-and-user-pages/" class="dropdown-item">Authentication and User Pages</a>
</li>
                                    
<li>
    <a href="../../django/deploy-and-finalizations/" class="dropdown-item">Deploy and Finalizations</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django REST Framework</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Introduction to DRF</a>
</li>
                                    
<li>
    <a href="../setting-up-django-project-and-drf/" class="dropdown-item">Setting Up a Django Project and DRF</a>
</li>
                                    
<li>
    <a href="../creating-the-first-api/" class="dropdown-item">Creating the First API</a>
</li>
                                    
<li>
    <a href="../implementing-crud-operations/" class="dropdown-item">Implementing CRUD Operations</a>
</li>
                                    
<li>
    <a href="../working-with-modelserializer/" class="dropdown-item">Working with ModelSerializer</a>
</li>
                                    
<li>
    <a href="../using-generic-api-views/" class="dropdown-item">Using Generic API Views</a>
</li>
                                    
<li>
    <a href="../viewsets-and-routers/" class="dropdown-item">ViewSets and Routers</a>
</li>
                                    
<li>
    <a href="../authentication-token-based/" class="dropdown-item">Authentication (Token-Based Authentication)</a>
</li>
                                    
<li>
    <a href="../working-with-permissions/" class="dropdown-item">Working with Permissions</a>
</li>
                                    
<li>
    <a href="../throttling-and-rate-limiting/" class="dropdown-item">Throttling and Rate Limiting</a>
</li>
                                    
<li>
    <a href="../filtering-searching-and-ordering/" class="dropdown-item">Filtering, Searching, and Ordering</a>
</li>
                                    
<li>
    <a href="../working-with-pagination/" class="dropdown-item">Working with Pagination</a>
</li>
                                    
<li>
    <a href="../jwt-authentication/" class="dropdown-item">JWT Authentication</a>
</li>
                                    
<li>
    <a href="../signals-and-drf/" class="dropdown-item">Signals and DRF</a>
</li>
                                    
<li>
    <a href="../background-tasks-and-celery/" class="dropdown-item">Background Tasks and Celery</a>
</li>
                                    
<li>
    <a href="../api-testing-and-unit-testing/" class="dropdown-item">API Testing and Unit Testing</a>
</li>
                                    
<li>
    <a href="../caching-and-performance-optimization/" class="dropdown-item">Caching and Performance Optimization</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">WebSockets and Django Channels</a>
</li>
                                    
<li>
    <a href="../deployment-and-docker/" class="dropdown-item">Deployment and Docker</a>
</li>
                                    
<li>
    <a href="../advanced-concepts-and-best-practices/" class="dropdown-item">Advanced Concepts and Best Practices</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../caching-and-performance-optimization/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../deployment-and-docker/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#17-dars-websockets-va-django-channels-bilan-ishlash" class="nav-link">üß© 17-DARS: WEBSOCKETS VA DJANGO CHANNELS BILAN ISHLASH</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-tayyorlov-ishlari" class="nav-link">‚úÖ 1. TAYYORLOV ISHLARI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-websocket-va-django-channels-ni-tushunish" class="nav-link">‚úÖ 2. WEBSOCKET VA DJANGO CHANNELS NI TUSHUNISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-django-channels-va-redis-ni-ornatish" class="nav-link">‚úÖ 3. DJANGO CHANNELS VA REDIS NI O'RNATISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-loyiha-sozlamalarini-yangilash" class="nav-link">‚úÖ 4. LOYIHA SOZLAMALARINI YANGILASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-asgi-sozlash" class="nav-link">‚úÖ 5. ASGI SOZLASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-websocket-routing" class="nav-link">‚úÖ 6. WEBSOCKET ROUTING</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#7-websocket-consumer-yaratish" class="nav-link">‚úÖ 7. WEBSOCKET CONSUMER YARATISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8-signal-orqali-websocket-bildirishnomasi" class="nav-link">‚úÖ 8. SIGNAL ORQALI WEBSOCKET BILDIRISHNOMASI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#9-klient-sayt-websocket-integratsiyasi" class="nav-link">‚úÖ 9. KLIENT-SAYT WEBSOCKET INTEGRATSIYASI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#10-websocket-ni-sinab-korish" class="nav-link">‚úÖ 10. WEBSOCKET NI SINAB KO'RISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#11-testlarni-yangilash" class="nav-link">‚úÖ 11. TESTLARNI YANGILASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#12-sinov-uchun-masalalar" class="nav-link">‚úÖ 12. SINOV UCHUN MASALALAR</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="17-dars-websockets-va-django-channels-bilan-ishlash">üß© 17-DARS: WEBSOCKETS VA DJANGO CHANNELS BILAN ISHLASH</h1>
<p>Bu darsda Django REST Framework (DRF) va Django Channels yordamida WebSocket integratsiyasini sozlashni bosqichma-bosqich o'rganamiz. WebSocket real vaqtda ikki tomonlama aloqani ta'minlaydi, masalan, vazifa yaratilganda foydalanuvchilarga bildirishnoma yuborish uchun. Har bir qadam tushunarli va faqat WebSocket va Django Channels ga qaratilgan bo'ladi. Oldingi darslarda sozlangan <code>myproject</code> loyihasi va <code>myapp</code> ilovasidagi <code>Task</code> modeli, JWT autentifikatsiyasi, ruxsatlar, sahifalash, Celery va keshlash asosida davom etamiz.</p>
<h2 id="1-tayyorlov-ishlari">‚úÖ 1. TAYYORLOV ISHLARI</h2>
<p>üìå Loyiha va ilova allaqachon sozlangan deb hisoblaymiz (<code>myproject</code>, <code>myapp</code>, va <code>Task</code> modeli). Quyidagi sozlamalar mavjud bo'lishi kerak:
- <code>Task</code> modeli <code>myapp/models.py</code> faylida belgilangan (shu jumladan <code>owner</code> maydoni).
- <code>TaskSerializer</code> <code>myapp/serializers.py</code> faylida yaratilgan.
- <code>TaskViewSet</code> <code>myapp/views.py</code> faylida sozlangan (JWT autentifikatsiyasi, ruxsatlar, filtrlash, sahifalash, Celery va keshlash bilan).
- Signallar va Celery <code>myapp/signals.py</code> va <code>myapp/tasks.py</code> fayllarida sozlangan.
- <code>/tasks/</code> endpointi <code>myproject/urls.py</code> faylida sozlangan.
üìå Agar bu sozlamalar hali amalga oshirilmagan bo'lsa, avvalgi darslarga qayting.</p>
<h2 id="2-websocket-va-django-channels-ni-tushunish">‚úÖ 2. WEBSOCKET VA DJANGO CHANNELS NI TUSHUNISH</h2>
<p>üìå <strong>WebSocket</strong>: HTTP dan farqli o'laroq, server va klient o'rtasida doimiy, ikki tomonlama aloqani ta'minlaydi. Bu real vaqtda ma'lumot uzatish (masalan, bildirishnomalar) uchun ideal.
üìå <strong>Django Channels</strong>: Django da WebSocket va asinxron vazifalarni boshqarish uchun ishlatiladi. U Redis kabi xabar brokeri orqali ishlaydi.
üìå Ushbu darsda vazifa yaratilganda barcha ulangan foydalanuvchilarga WebSocket orqali bildirishnoma yuboramiz.</p>
<h2 id="3-django-channels-va-redis-ni-ornatish">‚úÖ 3. DJANGO CHANNELS VA REDIS NI O'RNATISH</h2>
<p>üìå Quyidagi paketlarni o'rnatamiz:</p>
<pre><code class="language-bash">pip install channels channels-redis
</code></pre>
<p>üìå Redis allaqachon Celery va keshlash uchun o'rnatilgan. Redis serveri ishlayotganligiga ishonch hosil qiling:</p>
<pre><code class="language-bash">redis-server
redis-cli ping  # Javob: PONG
</code></pre>
<h2 id="4-loyiha-sozlamalarini-yangilash">‚úÖ 4. LOYIHA SOZLAMALARINI YANGILASH</h2>
<p>üìå <code>myproject/settings.py</code> faylida Channels va Redis sozlamalarini qo'shamiz:</p>
<pre><code class="language-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'django_filters',
    'channels',
    'myapp.apps.MyappConfig',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_THROTTLE_CLASSES': [
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle',
    ],
    'DEFAULT_THROTTLE_RATES': {
        'anon': '10/hour',
        'user': '20/hour',
    },
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 5,
}

# Celery sozlamalari
CELERY_BROKER_URL = 'redis://localhost:6379/0'
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'
CELERY_ACCEPT_CONTENT = ['json']
CELERY_TASK_SERIALIZER = 'json'
CELERY_RESULT_SERIALIZER = 'json'
CELERY_TIMEZONE = 'Asia/Tashkent'
CELERY_TASK_ALWAYS_EAGER = True

# Keshlash sozlamalari
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}

# Channels sozlamalari
ASGI_APPLICATION = 'myproject.asgi.application'
CHANNEL_LAYERS = {
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            'hosts': [('127.0.0.1', 6379)],
        },
    },
}
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>channels</code> ni <code>INSTALLED_APPS</code> ga qo'shdik.
- <code>ASGI_APPLICATION</code>: Django Channels uchun ASGI ilovasini belgilaydi.
- <code>CHANNEL_LAYERS</code>: Redis ni WebSocket xabarlari uchun ishlatadi.</p>
<h2 id="5-asgi-sozlash">‚úÖ 5. ASGI SOZLASH</h2>
<p>üìå <code>myproject/asgi.py</code> faylini yangilaymiz yoki yarating:</p>
<pre><code class="language-python">import os
from django.core.asgi import get_asgi_application
from channels.routing import ProtocolTypeRouter, URLRouter
from channels.auth import AuthMiddlewareStack
import myapp.routing

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproject.settings')

application = ProtocolTypeRouter({
    'http': get_asgi_application(),
    'websocket': AuthMiddlewareStack(
        URLRouter(
            myapp.routing.websocket_urlpatterns
        )
    ),
})
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>ProtocolTypeRouter</code>: HTTP va WebSocket so'rovlarini boshqaradi.
- <code>AuthMiddlewareStack</code>: WebSocket ulanishlarida autentifikatsiyani qo'llab-quvvatlaydi.</p>
<h2 id="6-websocket-routing">‚úÖ 6. WEBSOCKET ROUTING</h2>
<p>üìå <code>myapp/routing.py</code> faylini yarating va WebSocket marshrutlarini sozlang:</p>
<pre><code class="language-python">from django.urls import re_path
from . import consumers

websocket_urlpatterns = [
    re_path(r'ws/tasks/$', consumers.TaskConsumer.as_asgi()),
]
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>ws/tasks/</code>: WebSocket ulanishi uchun endpoint.
- <code>TaskConsumer</code>: WebSocket xabarlarini boshqaradi.</p>
<h2 id="7-websocket-consumer-yaratish">‚úÖ 7. WEBSOCKET CONSUMER YARATISH</h2>
<p>üìå <code>myapp/consumers.py</code> faylini yarating va quyidagi kodni qo'shing:</p>
<pre><code class="language-python">from channels.generic.websocket import AsyncWebsocketConsumer
import json

class TaskConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.channel_layer.group_add('tasks', self.channel_name)
        await self.accept()

    async def disconnect(self, close_code):
        await self.channel_layer.group_discard('tasks', self.channel_name)

    async def task_notification(self, event):
        await self.send(text_data=json.dumps({
            'message': event['message']
        }))
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>connect</code>: Foydalanuvchi WebSocket ga ulanganda <code>tasks</code> guruhiga qo'shiladi.
- <code>disconnect</code>: Ulanish uzilganda guruhdan chiqariladi.
- <code>task_notification</code>: Guruhdagi barcha foydalanuvchilarga xabar yuboradi.</p>
<h2 id="8-signal-orqali-websocket-bildirishnomasi">‚úÖ 8. SIGNAL ORQALI WEBSOCKET BILDIRISHNOMASI</h2>
<p>üìå <code>myapp/signals.py</code> faylini yangilaymiz va vazifa yaratilganda WebSocket orqali bildirishnoma yuboramiz:</p>
<pre><code class="language-python">from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from .models import Task
from .tasks import log_task_creation
from channels.layers import get_channel_layer
from asgiref.sync import async_to_sync
import logging

logger = logging.getLogger(__name__)

@receiver(post_save, sender=Task)
def handle_task_creation(sender, instance, created, **kwargs):
    if created:
        # Celery vazifasini fon rejimida ishga tushirish
        log_task_creation.delay(instance.id, instance.title, instance.owner.username)
        # WebSocket orqali bildirishnoma yuborish
        channel_layer = get_channel_layer()
        async_to_sync(channel_layer.group_send)(
            'tasks',
            {
                'type': 'task_notification',
                'message': f&quot;Yangi vazifa yaratildi: {instance.title} (Owner: {instance.owner.username})&quot;
            }
        )
    else:
        logger.info(f&quot;Vazifa yangilandi: {instance.title} (ID: {instance.id}, Owner: {instance.owner.username})&quot;)

@receiver(post_delete, sender=Task)
def log_task_deletion(sender, instance, **kwargs):
    logger.info(f&quot;Vazifa o'chirildi: {instance.title} (ID: {instance.id}, Owner: {instance.owner.username})&quot;)
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>group_send</code>: <code>tasks</code> guruhidagi barcha ulangan foydalanuvchilarga xabar yuboradi.
- <code>async_to_sync</code>: Asinxron Channels funksiyasini sinxron signalda ishlatish uchun.</p>
<h2 id="9-klient-sayt-websocket-integratsiyasi">‚úÖ 9. KLIENT-SAYT WEBSOCKET INTEGRATSIYASI</h2>
<p>üìå WebSocket ni sinash uchun oddiy HTML sahifasi yarating. <code>myapp/templates/index.html</code> faylini yarating:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;WebSocket Test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;WebSocket Bildirishnomalari&lt;/h1&gt;
    &lt;div id=&quot;notifications&quot;&gt;&lt;/div&gt;

    &lt;script&gt;
        const socket = new WebSocket('ws://localhost:8000/ws/tasks/');

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            const notifications = document.getElementById('notifications');
            const p = document.createElement('p');
            p.textContent = data.message;
            notifications.appendChild(p);
        };

        socket.onopen = function(event) {
            console.log('WebSocket ulandi');
        };

        socket.onclose = function(event) {
            console.log('WebSocket uzildi');
        };
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>üìå <code>myapp/urls.py</code> faylini yarating va HTML sahifasi uchun URL qo'shing:</p>
<pre><code class="language-python">from django.urls import path
from django.views.generic import TemplateView

urlpatterns = [
    path('', TemplateView.as_view(template_name='index.html'), name='index'),
]
</code></pre>
<p>üìå <code>myproject/urls.py</code> faylini yangilang:</p>
<pre><code class="language-python">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView
from myapp.views import TaskViewSet

router = DefaultRouter()
router.register(r'tasks', TaskViewSet)

urlpatterns = [
    path('', include(router.urls)),
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('ws/', include('myapp.urls')),  # WebSocket sahifasi uchun
]
</code></pre>
<h2 id="10-websocket-ni-sinab-korish">‚úÖ 10. WEBSOCKET NI SINAB KO'RISH</h2>
<p>üìå Serverni ishga tushiring (Django Channels Daphne bilan ishlaydi):</p>
<pre><code class="language-bash">pip install daphne
daphne -b 0.0.0.0 -p 8000 myproject.asgi:application
</code></pre>
<p>üìå Redis serveri ishlayotganligiga ishonch hosil qiling:</p>
<pre><code class="language-bash">redis-server
</code></pre>
<p>üìå Celery worker ni ishga tushiring (ixtiyoriy):</p>
<pre><code class="language-bash">celery -A myproject worker --loglevel=info
</code></pre>
<h3 id="foydalanuvchi-va-token-yaratish">‚ùáÔ∏è <strong>Foydalanuvchi va token yaratish</strong>:</h3>
<p>üìå Agar hali yaratilmagan bo'lsa, foydalanuvchi yarating:</p>
<pre><code class="language-bash">python manage.py createsuperuser  # username: testuser, password: testpass123
</code></pre>
<p>üìå JWT token oling:</p>
<pre><code class="language-bash">curl -X POST http://127.0.0.1:8000/api/token/ -H &quot;Content-Type: application/json&quot; -d '{&quot;username&quot;: &quot;testuser&quot;, &quot;password&quot;: &quot;testpass123&quot;}'
</code></pre>
<h3 id="websocket-sinovi">‚ùáÔ∏è <strong>WebSocket sinovi</strong>:</h3>
<ol>
<li>Brauzerda <code>http://localhost:8000/ws/</code> manzilini oching.</li>
<li>Yangi vazifa qo'shing:
   <code>bash
   curl -X POST http://127.0.0.1:8000/tasks/ -H "Authorization: Bearer &lt;access_token&gt;" -H "Content-Type: application/json" -d '{"title": "Yangi vazifa", "description": "Test"}'</code></li>
<li>Brauzerda bildirishnoma paydo bo'ladi: <code>Yangi vazifa yaratildi: Yangi vazifa (Owner: testuser)</code>.</li>
</ol>
<h2 id="11-testlarni-yangilash">‚úÖ 11. TESTLARNI YANGILASH</h2>
<p>üìå WebSocket ni sinash uchun <code>myapp/tests.py</code> fayliga test qo'shamiz:</p>
<pre><code class="language-python">from django.test import TestCase
from rest_framework.test import APITestCase
from rest_framework import status
from django.urls import reverse
from django.contrib.auth.models import User
from rest_framework_simplejwt.tokens import RefreshToken
from .models import Task
from .serializers import TaskSerializer
from django.core.cache import cache
from channels.testing import WebsocketCommunicator
from myapp.consumers import TaskConsumer
import logging

logger = logging.getLogger(__name__)

# Oldingi testlar (TaskModelTest, TaskSerializerTest, TaskSignalTest, TaskAPITest) shu yerda qoladi

class TaskWebSocketTest(TestCase):
    async def test_task_notification(self):
        communicator = WebsocketCommunicator(TaskConsumer.as_asgi(), &quot;/ws/tasks/&quot;)
        connected, subprotocol = await communicator.connect()
        self.assertTrue(connected)

        # Foydalanuvchi va vazifa yaratish
        user = User.objects.create_user(username='testuser', password='testpass123')
        task = Task.objects.create(title='Test vazifa', owner=user)

        # Bildirishnoma olish
        response = await communicator.receive_from()
        data = json.loads(response)
        self.assertEqual(data['message'], f&quot;Yangi vazifa yaratildi: Test vazifa (Owner: testuser)&quot;)

        await communicator.disconnect()
</code></pre>
<p>üìå Testlarni ishga tushirish:</p>
<pre><code class="language-bash">python manage.py test
</code></pre>
<h2 id="12-sinov-uchun-masalalar">‚úÖ 12. SINOV UCHUN MASALALAR</h2>
<p>üìå WebSocket ni sinash uchun quyidagi amallarni bajarib ko'ring:
1. <code>http://localhost:8000/ws/</code> manzilida WebSocket sahifasini oching.
2. <code>/tasks/</code> manzilida yangi vazifa qo'shing va brauzerda bildirishnoma oling.
3. Bir nechta brauzer oynasini ochib, guruh bildirishnomasini sinab ko'ring.
4. <code>python manage.py test</code> bilan WebSocket testini sinab ko'ring.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
