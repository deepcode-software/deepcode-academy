<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Umid">
        <link rel="canonical" href="https://deepcode-academy.vercel.app/drf/advanced-concepts-and-best-practices/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Advanced Concepts and Best Practices - DeepCode Academy</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">DeepCode Academy</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../python/what-is-python/" class="dropdown-item">What is Python</a>
</li>
                                    
<li>
    <a href="../../python/variables/" class="dropdown-item">Variables</a>
</li>
                                    
<li>
    <a href="../../python/data-types/" class="dropdown-item">Data Types</a>
</li>
                                    
<li>
    <a href="../../python/operators/" class="dropdown-item">Operatos</a>
</li>
                                    
<li>
    <a href="../../python/lists/" class="dropdown-item">Lists</a>
</li>
                                    
<li>
    <a href="../../python/tuples/" class="dropdown-item">Tuples</a>
</li>
                                    
<li>
    <a href="../../python/sets/" class="dropdown-item">Sets</a>
</li>
                                    
<li>
    <a href="../../python/dictionaries/" class="dropdown-item">Dictionaries</a>
</li>
                                    
<li>
    <a href="../../python/conditional-statements/" class="dropdown-item">Conditional Statements</a>
</li>
                                    
<li>
    <a href="../../python/for-loop/" class="dropdown-item">For Loop</a>
</li>
                                    
<li>
    <a href="../../python/while-loop/" class="dropdown-item">While Loop</a>
</li>
                                    
<li>
    <a href="../../python/functions/" class="dropdown-item">Functions</a>
</li>
                                    
<li>
    <a href="../../python/exception-handling/" class="dropdown-item">Exception Handling</a>
</li>
                                    
<li>
    <a href="../../python/moduls/" class="dropdown-item">Moduls</a>
</li>
                                    
<li>
    <a href="../../python/file-handling/" class="dropdown-item">File Handling</a>
</li>
                                    
<li>
    <a href="../../python/database/" class="dropdown-item">Database</a>
</li>
                                    
<li>
    <a href="../../python/third-party-packages/" class="dropdown-item">Third Party Packages</a>
</li>
                                    
<li>
    <a href="../../python/oop/" class="dropdown-item">OOP</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">PostgreSQL</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../psql/introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../../psql/postgresql/" class="dropdown-item">PostgreSQL</a>
</li>
                                    
<li>
    <a href="../../psql/basic-commands/" class="dropdown-item">Basic Commands</a>
</li>
                                    
<li>
    <a href="../../psql/data-retrieval-end-filtering/" class="dropdown-item">Data Retrieval and Filtering</a>
</li>
                                    
<li>
    <a href="../../psql/function-and-aggregation/" class="dropdown-item">Function and Aggregation</a>
</li>
                                    
<li>
    <a href="../../psql/data-manipulation/" class="dropdown-item">Data Manipulation</a>
</li>
                                    
<li>
    <a href="../../psql/joins-and-advanced-queries/" class="dropdown-item">Joins and Advanced Queries</a>
</li>
                                    
<li>
    <a href="../../psql/psql-connect-in-python/" class="dropdown-item">PostgreSQL connect in Python</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../django/introduction-to-django/" class="dropdown-item">Introduction to Django</a>
</li>
                                    
<li>
    <a href="../../django/django-project-structure/" class="dropdown-item">Django Project Structure</a>
</li>
                                    
<li>
    <a href="../../django/url-dispatcher-and-views/" class="dropdown-item">Url Dispatcher and Views</a>
</li>
                                    
<li>
    <a href="../../django/templates/" class="dropdown-item">Templates (Working with HTML)</a>
</li>
                                    
<li>
    <a href="../../django/static-files-and-bootstrap/" class="dropdown-item">Static Files and Bootstrap</a>
</li>
                                    
<li>
    <a href="../../django/django-orm-and-models/" class="dropdown-item">Django ORM and Models</a>
</li>
                                    
<li>
    <a href="../../django/django-admin-panel/" class="dropdown-item">Django Admin Panel</a>
</li>
                                    
<li>
    <a href="../../django/django-forms/" class="dropdown-item">Django Forms</a>
</li>
                                    
<li>
    <a href="../../django/crud-operations/" class="dropdown-item">CRUD Operations</a>
</li>
                                    
<li>
    <a href="../../django/queryset-and-filtering/" class="dropdown-item">QuerySet and Filtering</a>
</li>
                                    
<li>
    <a href="../../django/django-authentication-system/" class="dropdown-item">Django Authentication System</a>
</li>
                                    
<li>
    <a href="../../django/middleware-and-sessions/" class="dropdown-item">Middleware and Sessions</a>
</li>
                                    
<li>
    <a href="../../django/class-based-views/" class="dropdown-item">Class-Based Views (CBV)</a>
</li>
                                    
<li>
    <a href="../../django/django-messages-framework/" class="dropdown-item">Django Messages Framework</a>
</li>
                                    
<li>
    <a href="../../django/file-upload-and-media-files/" class="dropdown-item">File Upload and Media Files</a>
</li>
                                    
<li>
    <a href="../../django/project-planning/" class="dropdown-item">Project Planning</a>
</li>
                                    
<li>
    <a href="../../django/build-models-and-database/" class="dropdown-item">Build Models and Database</a>
</li>
                                    
<li>
    <a href="../../django/designing-and-frontend/" class="dropdown-item">Designing and Frontend</a>
</li>
                                    
<li>
    <a href="../../django/authentication-and-user-pages/" class="dropdown-item">Authentication and User Pages</a>
</li>
                                    
<li>
    <a href="../../django/deploy-and-finalizations/" class="dropdown-item">Deploy and Finalizations</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Django REST Framework</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../introduction/" class="dropdown-item">Introduction to DRF</a>
</li>
                                    
<li>
    <a href="../setting-up-django-project-and-drf/" class="dropdown-item">Setting Up a Django Project and DRF</a>
</li>
                                    
<li>
    <a href="../creating-the-first-api/" class="dropdown-item">Creating the First API</a>
</li>
                                    
<li>
    <a href="../implementing-crud-operations/" class="dropdown-item">Implementing CRUD Operations</a>
</li>
                                    
<li>
    <a href="../working-with-modelserializer/" class="dropdown-item">Working with ModelSerializer</a>
</li>
                                    
<li>
    <a href="../using-generic-api-views/" class="dropdown-item">Using Generic API Views</a>
</li>
                                    
<li>
    <a href="../viewsets-and-routers/" class="dropdown-item">ViewSets and Routers</a>
</li>
                                    
<li>
    <a href="../authentication-token-based/" class="dropdown-item">Authentication (Token-Based Authentication)</a>
</li>
                                    
<li>
    <a href="../working-with-permissions/" class="dropdown-item">Working with Permissions</a>
</li>
                                    
<li>
    <a href="../throttling-and-rate-limiting/" class="dropdown-item">Throttling and Rate Limiting</a>
</li>
                                    
<li>
    <a href="../filtering-searching-and-ordering/" class="dropdown-item">Filtering, Searching, and Ordering</a>
</li>
                                    
<li>
    <a href="../working-with-pagination/" class="dropdown-item">Working with Pagination</a>
</li>
                                    
<li>
    <a href="../jwt-authentication/" class="dropdown-item">JWT Authentication</a>
</li>
                                    
<li>
    <a href="../signals-and-drf/" class="dropdown-item">Signals and DRF</a>
</li>
                                    
<li>
    <a href="../background-tasks-and-celery/" class="dropdown-item">Background Tasks and Celery</a>
</li>
                                    
<li>
    <a href="../api-testing-and-unit-testing/" class="dropdown-item">API Testing and Unit Testing</a>
</li>
                                    
<li>
    <a href="../caching-and-performance-optimization/" class="dropdown-item">Caching and Performance Optimization</a>
</li>
                                    
<li>
    <a href="../websockets-and-django-channels/" class="dropdown-item">WebSockets and Django Channels</a>
</li>
                                    
<li>
    <a href="../deployment-and-docker/" class="dropdown-item">Deployment and Docker</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Advanced Concepts and Best Practices</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../deployment-and-docker/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#django-rest-framework-asoslari" class="nav-link">üåê DJANGO REST FRAMEWORK ASOSLARI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#19-dars-ilgor-tushunchalar-va-eng-yaxshi-amaliyotlar" class="nav-link">üß© 19-DARS: ILG'OR TUSHUNCHALAR VA ENG YAXSHI AMALIYOTLAR</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-tayyorlov-ishlari" class="nav-link">‚úÖ 1. TAYYORLOV ISHLARI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-ilgor-tushunchalar-va-eng-yaxshi-amaliyotlar-ni-tushunish" class="nav-link">‚úÖ 2. ILG'OR TUSHUNCHALAR VA ENG YAXSHI AMALIYOTLAR NI TUSHUNISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-paketlarni-ornatish" class="nav-link">‚úÖ 3. PAKETLARNI O'RNATISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-loyiha-sozlamalarini-yangilash" class="nav-link">‚úÖ 4. LOYIHA SOZLAMALARINI YANGILASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-api-versioning-ni-sozlash" class="nav-link">‚úÖ 5. API VERSIONING NI SOZLASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#6-maxsus-xatolik-boshqaruvi" class="nav-link">‚úÖ 6. MAXSUS XATOLIK BOSHQARUVI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#7-kod-tashkiloti-va-eng-yaxshi-amaliyotlar" class="nav-link">‚úÖ 7. KOD TASHKILOTI VA ENG YAXSHI AMALIYOTLAR</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#8-drf-spectacular-bilan-api-hujjatlari" class="nav-link">‚úÖ 8. DRF-SPECTACULAR BILAN API HUJJATLARI</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#9-testlarni-yangilash" class="nav-link">‚úÖ 9. TESTLARNI YANGILASH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#10-docker-sozlamalarini-tekshirish" class="nav-link">‚úÖ 10. DOCKER SOZLAMALARINI TEKSHIRISH</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#11-sinov-uchun-masalalar" class="nav-link">‚úÖ 11. SINOV UCHUN MASALALAR</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="django-rest-framework-asoslari">üåê DJANGO REST FRAMEWORK ASOSLARI</h1>
<h1 id="19-dars-ilgor-tushunchalar-va-eng-yaxshi-amaliyotlar">üß© 19-DARS: ILG'OR TUSHUNCHALAR VA ENG YAXSHI AMALIYOTLAR</h1>
<p>Bu darsda Django REST Framework (DRF) da ilg'or tushunchalar va eng yaxshi amaliyotlarni bosqichma-bosqich o'rganamiz. Biz API versioning, DRF-spectacular bilan avtomatik API hujjatlari, maxsus xatolik boshqaruvi va loyiha sifatini oshirish uchun eng yaxshi amaliyotlarni ko'rib chiqamiz. Har bir qadam tushunarli va faqat ilg'or tushunchalar va amaliyotlarga qaratilgan bo'ladi. Oldingi darslarda sozlangan <code>myproject</code> loyihasi va <code>myapp</code> ilovasidagi <code>Task</code> modeli, JWT autentifikatsiyasi, ruxsatlar, sahifalash, Celery, keshlash, WebSocket va Docker asosida davom etamiz.</p>
<h2 id="1-tayyorlov-ishlari">‚úÖ 1. TAYYORLOV ISHLARI</h2>
<p>üìå Loyiha va ilova allaqachon sozlangan deb hisoblaymiz (<code>myproject</code>, <code>myapp</code>, va <code>Task</code> modeli). Quyidagi sozlamalar mavjud bo'lishi kerak:
- <code>Task</code> modeli <code>myapp/models.py</code> faylida belgilangan (shu jumladan <code>owner</code> maydoni).
- <code>TaskSerializer</code> <code>myapp/serializers.py</code> faylida yaratilgan.
- <code>TaskViewSet</code> <code>myapp/views.py</code> faylida sozlangan (JWT autentifikatsiyasi, ruxsatlar, filtrlash, sahifalash, keshlash va WebSocket bilan).
- Signallar, Celery, WebSocket va testlar <code>myapp/signals.py</code>, <code>myapp/tasks.py</code>, <code>myapp/consumers.py</code> va <code>myapp/tests.py</code> fayllarida sozlangan.
- Docker sozlamalari <code>Dockerfile</code> va <code>docker-compose.yml</code> fayllarida mavjud.
üìå Agar bu sozlamalar hali amalga oshirilmagan bo'lsa, avvalgi darslarga qayting.</p>
<h2 id="2-ilgor-tushunchalar-va-eng-yaxshi-amaliyotlar-ni-tushunish">‚úÖ 2. ILG'OR TUSHUNCHALAR VA ENG YAXSHI AMALIYOTLAR NI TUSHUNISH</h2>
<p>üìå <strong>Ilg'or tushunchalar</strong>:
- <strong>API versioning</strong>: API ning turli versiyalarini qo'llab-quvvatlash.
- <strong>DRF-spectacular</strong>: Avtomatik API hujjatlari (OpenAPI/Swagger) yaratish.
- <strong>Maxsus xatolik boshqaruvi</strong>: API xatolarini markazlashgan tarzda boshqarish.
üìå <strong>Eng yaxshi amaliyotlar</strong>:
- Kod tashkiloti: Loyiha tuzilmasini soddalashtirish va qayta ishlatish.
- Xavfsizlik: API va ma'lumotlarni himoya qilish.
- Logging: Tahlil va xatolarni kuzatish uchun yaxshilangan logging.
- Test qamrovi: To'liq funksionallikni sinash.
üìå Ushbu darsda ushbu tushunchalarni loyihamizga qo'llaymiz.</p>
<h2 id="3-paketlarni-ornatish">‚úÖ 3. PAKETLARNI O'RNATISH</h2>
<p>üìå API versioning va DRF-spectacular uchun qo'shimcha paketlarni o'rnatamiz:</p>
<pre><code class="language-bash">pip install drf-spectacular
</code></pre>
<p>üìå <code>requirements.txt</code> faylini yangilang:</p>
<pre><code>django==4.2
djangorestframework==3.14
django-filter==23.2
djangorestframework-simplejwt==5.2
channels==4.0
channels-redis==4.0
django-redis==5.2
celery==5.2
redis==4.5
psycopg2-binary==2.9
daphne==4.0
drf-spectacular==0.26
</code></pre>
<h2 id="4-loyiha-sozlamalarini-yangilash">‚úÖ 4. LOYIHA SOZLAMALARINI YANGILASH</h2>
<p>üìå <code>myproject/settings.py</code> faylida API versioning va DRF-spectacular sozlamalarini qo'shamiz:</p>
<pre><code class="language-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'rest_framework.authtoken',
    'django_filters',
    'channels',
    'drf_spectacular',
    'myapp.apps.MyappConfig',
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_THROTTLE_CLASSES': [
        'rest_framework.throttling.AnonRateThrottle',
        'rest_framework.throttling.UserRateThrottle',
    ],
    'DEFAULT_THROTTLE_RATES': {
        'anon': '10/hour',
        'user': '20/hour',
    },
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 5,
    'DEFAULT_VERSIONING_CLASS': 'rest_framework.versioning.URLPathVersioning',  # API versioning
    'DEFAULT_VERSION': 'v1',  # Standart versiya
    'ALLOWED_VERSIONS': ['v1', 'v2'],  # Ruxsat etilgan versiyalar
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',  # DRF-spectacular
}

# PostgreSQL sozlamalari
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'mydb',
        'USER': 'myuser',
        'PASSWORD': 'mypassword',
        'HOST': 'db',
        'PORT': '5432',
    }
}

# Celery sozlamalari
CELERY_BROKER_URL = 'redis://redis:6379/0'
CELERY_RESULT_BACKEND = 'redis://redis:6379/0'
CELERY_ACCEPT_CONTENT = ['json']
CELERY_TASK_SERIALIZER = 'json'
CELERY_RESULT_SERIALIZER = 'json'
CELERY_TIMEZONE = 'Asia/Tashkent'
CELERY_TASK_ALWAYS_EAGER = False

# Keshlash sozlamalari
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://redis:6379/1',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}

# Channels sozlamalari
ASGI_APPLICATION = 'myproject.asgi.application'
CHANNEL_LAYERS = {
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            'hosts': [('redis', 6379)],
        },
    },
}

# Logging sozlamalari
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'debug.log',
            'formatter': 'verbose',
        },
        'console': {
            'level': 'INFO',
            'class': 'logging.StreamHandler',
            'formatter': 'verbose',
        },
    },
    'loggers': {
        'myapp': {
            'handlers': ['file', 'console'],
            'level': 'INFO',
            'propagate': True,
        },
        'django': {
            'handlers': ['file', 'console'],
            'level': 'INFO',
            'propagate': True,
        },
    },
}
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>DEFAULT_VERSIONING_CLASS</code>: URL da versiyalashni yoqadi (masalan, <code>/v1/tasks/</code>).
- <code>DEFAULT_SCHEMA_CLASS</code>: DRF-spectacular ni API hujjatlari uchun sozlaydi.
- <code>LOGGING</code>: Formatlangan loglar uchun <code>verbose</code> formater qo'shildi.</p>
<h2 id="5-api-versioning-ni-sozlash">‚úÖ 5. API VERSIONING NI SOZLASH</h2>
<p>üìå <code>myproject/urls.py</code> faylini yangilaymiz va versiyalashni qo'llab-quvvatlaymiz:</p>
<pre><code class="language-python">from django.urls import path, include
from rest_framework.routers import DefaultRouter
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView
from myapp.views import TaskViewSet
from drf_spectacular.views import SpectacularAPIView, SpectacularSwaggerView

router = DefaultRouter()
router.register(r'tasks', TaskViewSet)

urlpatterns = [
    path('', include('myapp.urls')),  # WebSocket sahifasi uchun
    path('v1/', include(router.urls)),  # v1 versiyasi
    path('v2/', include(router.urls)),  # v2 versiyasi (keyinchalik farqlarni qo'shish mumkin)
    path('v1/api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('v1/api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('v1/schema/', SpectacularAPIView.as_view(), name='schema'),  # API sxemasi
    path('v1/docs/', SpectacularSwaggerView.as_view(url_name='schema'), name='swagger-ui'),  # Swagger UI
]
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>v1/</code> va <code>v2/</code>: API versiyalari uchun prefikslar.
- <code>SpectacularAPIView</code>: OpenAPI sxemasini yaratadi.
- <code>SpectacularSwaggerView</code>: Swagger UI ni ta'minlaydi.</p>
<h2 id="6-maxsus-xatolik-boshqaruvi">‚úÖ 6. MAXSUS XATOLIK BOSHQARUVI</h2>
<p>üìå <code>myapp/exceptions.py</code> faylini yarating va maxsus xatolik sinfini qo'shing:</p>
<pre><code class="language-python">from rest_framework.views import exception_handler
from rest_framework.response import Response
from rest_framework import status

def custom_exception_handler(exc, context):
    response = exception_handler(exc, context)

    if response is not None:
        custom_response = {
            'error': {
                'status_code': response.status_code,
                'message': str(exc),
                'detail': response.data
            }
        }
        response.data = custom_response

    return response
</code></pre>
<p>üìå <code>myproject/settings.py</code> faylida xatolik boshqaruvchisini sozlang:</p>
<pre><code class="language-python">REST_FRAMEWORK = {
    ...
    'EXCEPTION_HANDLER': 'myapp.exceptions.custom_exception_handler',
}
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>custom_exception_handler</code>: API xatolarini moslashtirilgan formatda qaytaradi (masalan, <code>{'error': {...}}</code>).</p>
<h2 id="7-kod-tashkiloti-va-eng-yaxshi-amaliyotlar">‚úÖ 7. KOD TASHKILOTI VA ENG YAXSHI AMALIYOTLAR</h2>
<p>üìå Quyidagi amaliyotlarni qo'llaymiz:
- <strong>Modulli tuzilma</strong>: Kodni <code>models</code>, <code>serializers</code>, <code>views</code>, <code>permissions</code>, <code>pagination</code>, <code>signals</code>, <code>tasks</code>, <code>consumers</code> va <code>exceptions</code> kabi alohida fayllarga ajratdik.
- <strong>Xavfsizlik</strong>:
  - JWT autentifikatsiyasi va <code>IsOwnerOrReadOnly</code> ruxsatlarini qo'lladik.
  - <code>ALLOWED_HOSTS</code> ni sozlash:
    <code>python
    ALLOWED_HOSTS = ['localhost', '127.0.0.1', 'your-domain.com']</code>
  - HTTPS ni Nginx orqali sozlash (ishlab chiqarishda).
- <strong>Logging</strong>: Formatlangan loglar qo'shildi (<code>verbose</code> formater).
- <strong>Test qamrovi</strong>: Oldingi darsda yozilgan testlar loyiha funksionalligini qamrab oladi.
- <strong>Ma'lumotlar bazasi optimallashtirish</strong>: <code>select_related</code> qo'llanildi.</p>
<h2 id="8-drf-spectacular-bilan-api-hujjatlari">‚úÖ 8. DRF-SPECTACULAR BILAN API HUJJATLARI</h2>
<p>üìå <code>myapp/views.py</code> faylida <code>TaskViewSet</code> ni DRF-spectacular uchun hujjatlaymiz:</p>
<pre><code class="language-python">from rest_framework import viewsets
from django_filters.rest_framework import DjangoFilterBackend
from rest_framework.filters import SearchFilter, OrderingFilter
from django.views.decorators.cache import cache_page
from django.utils.decorators import method_decorator
from .models import Task
from .serializers import TaskSerializer
from .permissions import IsOwnerOrReadOnly
from .pagination import CustomTaskPagination
from rest_framework.permissions import IsAuthenticated
from drf_spectacular.utils import extend_schema, OpenApiParameter

class TaskViewSet(viewsets.ModelViewSet):
    queryset = Task.objects.all().select_related('owner')
    serializer_class = TaskSerializer
    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]
    filter_backends = [DjangoFilterBackend, SearchFilter, OrderingFilter]
    filterset_fields = ['completed', 'owner']
    search_fields = ['title', 'description']
    ordering_fields = ['created_at', 'completed']
    ordering = ['created_at']
    pagination_class = CustomTaskPagination

    def perform_create(self, serializer):
        serializer.save(owner=self.request.user)

    @method_decorator(cache_page(60 * 5))
    @extend_schema(
        description='Barcha vazifalarni ro\'yxatini qaytaradi, sahifalash va filtrlash qo\'llaniladi.',
        parameters=[
            OpenApiParameter(name='completed', description='Vazifa holati (true/false)', required=False, type=bool),
            OpenApiParameter(name='search', description='Sarlavha yoki tavsif bo\'yicha qidirish', required=False, type=str),
        ]
    )
    def list(self, request, *args, **kwargs):
        return super().list(request, *args, **kwargs)
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>@extend_schema</code>: API endpointi uchun hujjatlashtirish qo'shadi.
- <code>OpenApiParameter</code>: Filtr va qidiruv parametrlari uchun hujjatlashtirish.</p>
<h2 id="9-testlarni-yangilash">‚úÖ 9. TESTLARNI YANGILASH</h2>
<p>üìå <code>myapp/tests.py</code> fayliga API versioning va xatolik boshqaruvini sinash uchun testlar qo'shamiz:</p>
<pre><code class="language-python">from django.test import TestCase
from rest_framework.test import APITestCase
from rest_framework import status
from django.urls import reverse
from django.contrib.auth.models import User
from rest_framework_simplejwt.tokens import RefreshToken
from .models import Task
from .serializers import TaskSerializer
from django.core.cache import cache
from channels.testing import WebsocketCommunicator
from myapp.consumers import TaskConsumer
import json
import logging

logger = logging.getLogger(__name__)

# Oldingi testlar (TaskModelTest, TaskSerializerTest, TaskSignalTest, TaskAPITest, TaskWebSocketTest) shu yerda qoladi

class TaskAdvancedTest(APITestCase):
    def setUp(self):
        self.user = User.objects.create_user(username='testuser', password='testpass123')
        self.token = RefreshToken.for_user(self.user).access_token
        self.client.credentials(HTTP_AUTHORIZATION=f'Bearer {self.token}')
        cache.clear()

    def test_api_versioning(self):
        url_v1 = reverse('task-list', kwargs={'version': 'v1'})
        response_v1 = self.client.get(url_v1)
        self.assertEqual(response_v1.status_code, status.HTTP_200_OK)

        url_v2 = reverse('task-list', kwargs={'version': 'v2'})
        response_v2 = self.client.get(url_v2)
        self.assertEqual(response_v2.status_code, status.HTTP_200_OK)

    def test_custom_exception_handler(self):
        url = reverse('task-detail', kwargs={'version': 'v1', 'pk': 999})  # Mavjud bo'lmagan ID
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_404_NOT_FOUND)
        self.assertIn('error', response.data)
        self.assertEqual(response.data['error']['status_code'], 404)
        self.assertIn('detail', response.data['error'])

    def test_api_documentation(self):
        url = reverse('schema', kwargs={'version': 'v1'})
        response = self.client.get(url)
        self.assertEqual(response.status_code, status.HTTP_200_OK)
</code></pre>
<p>üìå <strong>Tushuntirish</strong>:
- <code>test_api_versioning</code>: <code>v1</code> va <code>v2</code> versiyalarini sinaydi.
- <code>test_custom_exception_handler</code>: Maxsus xatolik formatini tekshiradi.
- <code>test_api_documentation</code>: API sxemasining mavjudligini sinaydi.</p>
<h2 id="10-docker-sozlamalarini-tekshirish">‚úÖ 10. DOCKER SOZLAMALARINI TEKSHIRISH</h2>
<p>üìå <code>docker-compose.yml</code> faylida o'zgarishlar talab qilinmaydi, lekin <code>requirements.txt</code> yangilanganligi uchun konteynerni qayta quring:</p>
<pre><code class="language-bash">docker-compose up --build
</code></pre>
<h2 id="11-sinov-uchun-masalalar">‚úÖ 11. SINOV UCHUN MASALALAR</h2>
<p>üìå Ilg'or tushunchalar va amaliyotlarni sinash uchun quyidagi amallarni bajarib ko'ring:
1. <code>http://localhost/v1/docs/</code> manzilida Swagger UI ni oching va API hujjatlarini ko'ring.
2. <code>http://localhost/v1/tasks/</code> va <code>http://localhost/v2/tasks/</code> manzillarini sinab, versiyalashni tekshiring.
3. Mavjud bo'lmagan vazifani so'rang (<code>/v1/tasks/999/</code>) va maxsus xatolik formatini ko'ring.
4. <code>python manage.py test</code> bilan yangi testlarni sinab ko'ring.
5. Loglarni <code>debug.log</code> faylida tekshiring va formatlangan xabarlarni ko'ring.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
